<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quadrature · BEAST.jl</title><meta name="title" content="Quadrature · BEAST.jl"/><meta property="og:title" content="Quadrature · BEAST.jl"/><meta property="twitter:title" content="Quadrature · BEAST.jl"/><meta name="description" content="Documentation for BEAST.jl."/><meta property="og:description" content="Documentation for BEAST.jl."/><meta property="twitter:description" content="Documentation for BEAST.jl."/><meta property="og:url" content="https://krcools.github.io/BEAST.jl/internals/quadstrat/"/><meta property="twitter:url" content="https://krcools.github.io/BEAST.jl/internals/quadstrat/"/><link rel="canonical" href="https://krcools.github.io/BEAST.jl/internals/quadstrat/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="BEAST.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="BEAST.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">BEAST.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/usage/">General Usage</a></li><li><a class="tocitem" href="../../manual/customexc/">Custom excitations</a></li><li><a class="tocitem" href="../../manual/quadstrat/">Setting the Quadrature Strategy</a></li><li><a class="tocitem" href="../../manual/quadrule/">Custom Quadrature Rules</a></li><li><a class="tocitem" href="../../manual/customop/">Custom Operators</a></li><li><input class="collapse-toggle" id="menuitem-2-6" type="checkbox"/><label class="tocitem" for="menuitem-2-6"><span class="docs-label">Application Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-2-6-1" type="checkbox"/><label class="tocitem" for="menuitem-2-6-1"><span class="docs-label">Time-Harmonic</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/examplesTH/efie/">EFIE</a></li><li><a class="tocitem" href="../../manual/examplesTH/mfie/">MFIE</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-6-2" type="checkbox"/><label class="tocitem" for="menuitem-2-6-2"><span class="docs-label">Time-Domain</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/examplesTD/tdefie/">EFIE</a></li></ul></li></ul></li><li><a class="tocitem" href="../../manual/bilinear/">System of Equations and Bilinear Forms</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/efie/">EFIE</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Operators &amp; Excitations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../operators/overview/">Overview</a></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Local Operators</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../operators/identity/">Identiy</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Boundary Integral Operators</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../operators/helmholtz/">Helmholtz</a></li><li><input class="collapse-toggle" id="menuitem-4-3-2" type="checkbox"/><label class="tocitem" for="menuitem-4-3-2"><span class="docs-label">Maxwell Single Layer</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../operators/maxwellsinglelayer/">Time Harmonic</a></li><li><a class="tocitem" href="../../operators/maxwellsinglelayer_td/">Time Domain</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3-3"><span class="docs-label">Maxwell Double Layer</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../operators/maxwelldoublelayer/">Time Harmonic</a></li><li><a class="tocitem" href="../../operators/maxwelldoublelayer_td/">Time Domain</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Volume Integral Operators</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../operators/maxwellsinglelayerVIE/">Maxwell Single Layer</a></li><li><span class="tocitem">Maxwell Double Layer</span></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox"/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Excitations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../excitations/planewave/">Plane Wave</a></li><li><a class="tocitem" href="../../excitations/dipole/">Dipole</a></li><li><a class="tocitem" href="../../excitations/monopole/">Monopole</a></li><li><a class="tocitem" href="../../excitations/linearpotential/">Linear Potential</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Basis Functions</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../bases/overview/">Overview</a></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Spatial</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../bases/raviartthomas/">Raviart Thomas</a></li><li><a class="tocitem" href="../../bases/buffachristiansen/">Buffa Christiansen</a></li><li><a class="tocitem" href="../../bases/brezzidouglasmarini/">Brezzi-Douglas-Marini</a></li><li><a class="tocitem" href="../../bases/gragliawiltonpeterson/">Graglia-Wilton-Peterson</a></li></ul></li><li><span class="tocitem">Temporal</span></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Geometry Representations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../geometry/flat/">Flat</a></li><li><span class="tocitem">Curvilinear</span></li></ul></li><li><span class="tocitem">____________________________________</span></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox" checked/><label class="tocitem" for="menuitem-8"><span class="docs-label">Internals</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../overview/">Overview</a></li><li><a class="tocitem" href="../assemble/">The Matrix Assemble Routine</a></li><li class="is-active"><a class="tocitem" href>Quadrature</a><ul class="internal"><li><a class="tocitem" href="#quaddata-and-quadrule"><span>quaddata and quadrule</span></a></li><li><a class="tocitem" href="#quadstrat"><span>quadstrat</span></a></li></ul></li><li><span class="tocitem">Parametric Domain</span></li><li><span class="tocitem">Multithreading</span></li></ul></li><li><a class="tocitem" href="../../contributing/">Contributing</a></li><li><a class="tocitem" href="../../references/">References</a></li><li><a class="tocitem" href="../../apiref/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Internals</a></li><li class="is-active"><a href>Quadrature</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Quadrature</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/krcools/BEAST.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/krcools/BEAST.jl/blob/master/docs/src/internals/quadstrat.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Quadrature-strategies"><a class="docs-heading-anchor" href="#Quadrature-strategies">Quadrature strategies</a><a id="Quadrature-strategies-1"></a><a class="docs-heading-anchor-permalink" href="#Quadrature-strategies" title="Permalink"></a></h1><p>There are many ways to approximately compute the singular integrals that appear in boundary element discretisations of surface and volume integral euqations.</p><p>BEAST.jl is configured to select reasonable defaults, but advanced users may want to select their own quadrature rules. This section provides information on how to do this.</p><div class="admonition is-warning" id="Warning-e56e453e509d0034"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-e56e453e509d0034" title="Permalink"></a></header><div class="admonition-body"><p>TODO: discuss directly available/implemented singularity treatment</p></div></div><h2 id="quaddata-and-quadrule"><a class="docs-heading-anchor" href="#quaddata-and-quadrule">quaddata and quadrule</a><a id="quaddata-and-quadrule-1"></a><a class="docs-heading-anchor-permalink" href="#quaddata-and-quadrule" title="Permalink"></a></h2><p>Numerical quadrature is governed by a pair of functions that need to be designed to work together:</p><ul><li><code>quaddata</code>: this function is executed before the assembly loop is entered. It&#39;s job is to compute all data needed for quadrature that the developer wants to be cached. Typically this is all geometric information such as the parametric and cartesian coordinates of all quadratures rules for all elemenents. It makes sense to cache this data as it will be used many times over in the double for loop that governs assembly. Typically, near singular interactions require more careful treatment than far interactions. This means that multiple quadrature rules per elements can be required. In such cases, the developer may want to opt to sture quadrature points and weights for all these rules. The function returns a quaddata object that holds all the cached data.</li><li><code>quadrule</code>: quadrule is executed inside the assembly hotloop. It receives a pair of elements and the quaddata object as its arguments. Based on this, the relevant cached data is extracted and stored in a quadrule object. The type of this object will determine the actual quadrature routined that will be called upon to do the numerical quadrature.</li></ul><h2 id="quadstrat"><a class="docs-heading-anchor" href="#quadstrat">quadstrat</a><a id="quadstrat-1"></a><a class="docs-heading-anchor-permalink" href="#quadstrat" title="Permalink"></a></h2><p>The pair of quaddata and quadrule methods that is used is determined by the type of the operator and finite elements, and a <code>quadstrat</code> object. This object is passed to the assembly routine and passed on to <code>quaddata</code> and <code>quadstrat</code>, so it can be considered during dispatch.</p><p>Parameters, such as those that determine the accuracy of the numerical quadrature, are part of the runtime payload of the quadstrat object. This is usefull when the user is interested on the impact of these parameters on the performance and the accuracy of the solver without having to supply a new pair of <code>quadstrat</code>/<code>quaddata</code> methods for each possible value of these parameters.</p><p>Roughly this leads to the following (simplified) assembly routine:</p><pre><code class="language-julia hljs">function assemble(op, tfs, bfs, store; quadstrat=QS)

    tad, tels = assemblydata(op, tfs)
    bad, bels = assemblydata(op, bfs)
    
    qd = quadata(op,tels,bels,quadstrat)
    for tel in tels
        for bel in bels
            qr = quadrule(op,tel,bel,qd,quadstrat)
            zlocal = momintegrals(op,tel,bel,qr)

            for i in axes(zlocal,1)
                for j in axes(zlocal,2)
                    m, a = tad[tel,i]
                    n, b = bad[bel,j]
                    store(a*zlocal[i,j]*b,m,n)
end end end end end</code></pre><p>It is conceivable that the types and functions described above look like this:</p><pre><code class="language-julia hljs">struct DoubleNumQS
    test_precision
    trial_precision
end

function quaddata(op, tels, bels, quadstrat::DoubleNumQS)
    tqps = [quadpoints(tel,precision=quadstrat.test_precision) for tel in tels]
    bqps = [quadpoints(bel,precision=quadstrat.basis_precision) for bel in bels]
    return (test_quadpoints=tqps, basis_quadpoints=bqps)
end


struct DoubleNumQR
    test_quadpoints
    trial_quadpoints
end

struct HighPrecisionQR end

function quadrule(op, tel, bel, qd, quadstrat::DoubleNumQs)
    if wellseparated(tel, bel)
        return DoubleNumQR(qd.test_quadpoints[tel], qd.basis_quadpoints[bel])
    else
        return HighPrecisionQR(tel, bel)
    end
end

function momintegrals(op, tel, bel, qr::DoubleNumQR)
    ...
end

function momintegrals(op, tel, bel, qr::HighPrecisionQR)
    ...
end</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../assemble/">« The Matrix Assemble Routine</a><a class="docs-footer-nextpage" href="../../contributing/">Contributing »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.12.0 on <span class="colophon-date" title="Tuesday 17 June 2025 12:51">Tuesday 17 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
